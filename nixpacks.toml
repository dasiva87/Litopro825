[phases.setup]
nixPkgs = ['php83', 'php83Packages.composer', 'nodejs_20']

[phases.install]
cmds = [
  'composer install --no-dev --optimize-autoloader --no-interaction',
  'npm ci'
]

[phases.build]
cmds = [
  'npm run build',
  'php artisan config:cache',
  'php artisan route:cache',
  'php artisan view:cache'
]

[start]
cmd = 'php artisan migrate --force && php artisan grafired:clear-cache --production && php artisan storage:link && /usr/bin/unitd --no-daemon --control unix:/run/control.unit.sock'

# NOTA: Para el primer deployment, ejecutar manualmente:
# php artisan db:seed --class=MinimalProductionSeeder --force
#
# Esto crear치:
# - 4 planes de suscripci칩n (Free, B치sico, Profesional, Empresarial)
# - 5 roles y permisos del sistema
# - 1 usuario super-admin (admin@grafired.com / GrafiRed2026!)
# - Datos geogr치ficos, tipos de documentos, acabados