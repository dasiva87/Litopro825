<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LitoPro 3.0 - Documentaci√≥n T√©cnica</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2d3748;
            border-bottom: 3px solid #4f46e5;
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-align: center;
        }
        h2 {
            color: #4f46e5;
            border-left: 4px solid #4f46e5;
            padding-left: 20px;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        h3 {
            color: #2d3748;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        h4 {
            color: #4a5568;
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .tech-stack {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .tech-stack ul {
            margin: 0;
            padding-left: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        th {
            background: #4f46e5;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        tr:hover {
            background: #e2e8f0;
        }
        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.9em;
            color: #e53e3e;
        }
        pre {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.9em;
            line-height: 1.5;
            margin: 20px 0;
            position: relative;
        }
        pre::before {
            content: attr(data-language);
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 0.8em;
            color: #a0aec0;
            text-transform: uppercase;
        }
        .highlight {
            background: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #38b2ac;
            margin: 20px 0;
        }
        .warning {
            background: linear-gradient(120deg, #ffecd2 0%, #fcb69f 100%);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ed8936;
            margin: 20px 0;
        }
        .success {
            background: linear-gradient(120deg, #d4edda 0%, #c3e6cb 100%);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #38a169;
            margin: 20px 0;
        }
        .toc {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
            border: 1px solid #e2e8f0;
        }
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        .toc ul ul {
            padding-left: 20px;
        }
        .toc a {
            color: #4f46e5;
            text-decoration: none;
            padding: 5px 0;
            display: block;
            border-radius: 4px;
            padding-left: 10px;
            transition: all 0.2s;
        }
        .toc a:hover {
            background: #e2e8f0;
            padding-left: 15px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        .emoji {
            font-size: 1.2em;
            margin-right: 8px;
        }
        .section-divider {
            border: none;
            height: 2px;
            background: linear-gradient(90deg, transparent, #4f46e5, transparent);
            margin: 50px 0;
        }
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            h1 {
                font-size: 2em;
            }
            pre {
                padding: 15px;
                font-size: 0.8em;
            }
            table {
                font-size: 0.9em;
            }
            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span class="emoji">üìñ</span>LitoPro 3.0 - Documentaci√≥n T√©cnica Completa</h1>

        <div class="toc">
            <h3>üìã √çndice de Contenido</h3>
            <ul>
                <li><a href="#arquitectura">üèóÔ∏è Arquitectura General</a></li>
                <li><a href="#modelos">üèõÔ∏è An√°lisis de Modelos</a></li>
                <li><a href="#polimorfico">üßÆ Sistema Polim√≥rfico de Items</a></li>
                <li><a href="#servicios">‚öôÔ∏è Servicios Calculadores</a></li>
                <li><a href="#filament">üéõÔ∏è An√°lisis de Filament Resources</a></li>
                <li><a href="#migraciones">üóÑÔ∏è An√°lisis de Migraciones</a></li>
                <li><a href="#testing">üß™ An√°lisis de Testing</a></li>
                <li><a href="#comandos">üöÄ Comandos y Herramientas</a></li>
                <li><a href="#configuracion">üìã Configuraci√≥n y Deployment</a></li>
                <li><a href="#metricas">üìä M√©tricas y Rendimiento</a></li>
                <li><a href="#roadmap">üîÆ Roadmap y Mejoras Futuras</a></li>
                <li><a href="#conclusiones">‚úÖ Conclusiones</a></li>
            </ul>
        </div>

        <h2 id="arquitectura"><span class="emoji">üèóÔ∏è</span>Arquitectura General</h2>

        <p>LitoPro es un SaaS multi-tenant para litograf√≠as desarrollado en Laravel 12.25.0 con Filament 4.0.3, dise√±ado para gestionar cotizaciones, inventarios y producci√≥n de manera especializada.</p>

        <div class="tech-stack">
            <h3>Stack Tecnol√≥gico</h3>
            <ul>
                <li><strong>Backend:</strong> Laravel 12.25.0 + PHP 8.3.21</li>
                <li><strong>Frontend:</strong> Filament 4.0.3 + Livewire 3.6.4 + TailwindCSS 4.1.12</li>
                <li><strong>Base de Datos:</strong> MySQL con multi-tenancy</li>
                <li><strong>Testing:</strong> PHPUnit con 60+ tests (Feature + Unit)</li>
            </ul>
        </div>

        <hr class="section-divider">

        <h2 id="modelos"><span class="emoji">üèõÔ∏è</span>An√°lisis de Modelos</h2>

        <div class="highlight">
            <h3><span class="emoji">üîê</span>Multi-Tenancy Core</h3>
            <p>Todos los modelos principales implementan multi-tenancy usando el trait <code>BelongsToTenant</code> con scopes autom√°ticos por <code>company_id</code>.</p>
        </div>

        <h4>Trait BelongsToTenant</h4>
        <pre data-language="php">// app/Models/Concerns/BelongsToTenant.php
trait BelongsToTenant
{
    protected static function booted()
    {
        static::addGlobalScope(new BelongsToTenantScope);

        static::creating(function ($model) {
            $model->company_id = auth()->user()->company_id ?? 1;
        });
    }
}</pre>

        <h3><span class="emoji">üë§</span>Modelo User</h3>
        <table>
            <thead>
                <tr>
                    <th>Campo</th>
                    <th>Tipo</th>
                    <th>Descripci√≥n</th>
                </tr>
            </thead>
            <tbody>
                <tr><td><code>id</code></td><td>bigint</td><td>Clave primaria</td></tr>
                <tr><td><code>company_id</code></td><td>bigint</td><td>FK: Multi-tenancy</td></tr>
                <tr><td><code>name</code></td><td>string</td><td>Nombre completo</td></tr>
                <tr><td><code>email</code></td><td>string</td><td>Email √∫nico</td></tr>
                <tr><td><code>document_type</code></td><td>string</td><td>Tipo documento (CC, NIT, etc.)</td></tr>
                <tr><td><code>document_number</code></td><td>string</td><td>N√∫mero documento</td></tr>
                <tr><td><code>phone</code></td><td>string</td><td>Tel√©fono</td></tr>
                <tr><td><code>address</code></td><td>string</td><td>Direcci√≥n</td></tr>
                <tr><td><code>city_id</code></td><td>bigint</td><td>FK: Ciudad</td></tr>
            </tbody>
        </table>

        <div class="success">
            <strong>Traits Utilizados:</strong>
            <code>HasFactory</code>, <code>Notifiable</code>, <code>HasRoles</code>, <code>SoftDeletes</code>, <code>BelongsToTenant</code>
        </div>

        <h4>Relaciones User</h4>
        <pre data-language="php">public function company(): BelongsTo // belongsTo(Company::class)
public function city(): BelongsTo    // belongsTo(City::class)</pre>

        <h3><span class="emoji">üè¢</span>Modelo Company</h3>
        <table>
            <thead>
                <tr>
                    <th>Campo</th>
                    <th>Tipo</th>
                    <th>Descripci√≥n</th>
                </tr>
            </thead>
            <tbody>
                <tr><td><code>id</code></td><td>bigint</td><td>Clave primaria</td></tr>
                <tr><td><code>name</code></td><td>string</td><td>Nombre empresa</td></tr>
                <tr><td><code>document_type</code></td><td>string</td><td>Tipo documento</td></tr>
                <tr><td><code>document_number</code></td><td>string</td><td>NIT/RUT</td></tr>
                <tr><td><code>phone</code></td><td>string</td><td>Tel√©fono principal</td></tr>
                <tr><td><code>email</code></td><td>string</td><td>Email corporativo</td></tr>
                <tr><td><code>address</code></td><td>string</td><td>Direcci√≥n f√≠sica</td></tr>
                <tr><td><code>city_id</code></td><td>bigint</td><td>FK: Ciudad</td></tr>
                <tr><td><code>website</code></td><td>string</td><td>Sitio web</td></tr>
                <tr><td><code>logo</code></td><td>string</td><td>Ruta del logo</td></tr>
            </tbody>
        </table>

        <h4>Relaciones Company</h4>
        <pre data-language="php">public function users(): HasMany          // hasMany(User::class)
public function city(): BelongsTo         // belongsTo(City::class)
public function settings(): HasOne        // hasOne(CompanySettings::class)
public function documents(): HasMany      // hasMany(Document::class)
public function contacts(): HasMany       // hasMany(Contact::class)
public function products(): HasMany       // hasMany(Product::class)</pre>

        <hr class="section-divider">

        <h2 id="polimorfico"><span class="emoji">üßÆ</span>Sistema Polim√≥rfico de Items</h2>

        <div class="highlight">
            <h3><span class="emoji">üìÑ</span>Sistema de Documentos (Cotizaciones)</h3>
            <p>El <strong>DocumentItem</strong> es el n√∫cleo polim√≥rfico que permite asociar cualquier tipo de item a un documento.</p>
        </div>

        <h4>Modelo Document</h4>
        <table>
            <thead>
                <tr>
                    <th>Campo</th>
                    <th>Tipo</th>
                    <th>Descripci√≥n</th>
                </tr>
            </thead>
            <tbody>
                <tr><td><code>id</code></td><td>bigint</td><td>Clave primaria</td></tr>
                <tr><td><code>company_id</code></td><td>bigint</td><td>FK: Multi-tenancy</td></tr>
                <tr><td><code>user_id</code></td><td>bigint</td><td>FK: Usuario creador</td></tr>
                <tr><td><code>contact_id</code></td><td>bigint</td><td>FK: Cliente</td></tr>
                <tr><td><code>document_type_id</code></td><td>bigint</td><td>FK: Tipo documento</td></tr>
                <tr><td><code>document_number</code></td><td>string</td><td>N√∫mero √∫nico</td></tr>
                <tr><td><code>reference</code></td><td>string</td><td>Referencia cliente</td></tr>
                <tr><td><code>status</code></td><td>enum</td><td>Estado: draft, sent, approved, in_production, completed, cancelled</td></tr>
                <tr><td><code>subtotal</code></td><td>decimal</td><td>Subtotal antes de impuestos</td></tr>
                <tr><td><code>tax_amount</code></td><td>decimal</td><td>Valor impuestos</td></tr>
                <tr><td><code>discount_amount</code></td><td>decimal</td><td>Descuentos aplicados</td></tr>
                <tr><td><code>total</code></td><td>decimal</td><td>Total final</td></tr>
                <tr><td><code>notes</code></td><td>text</td><td>Observaciones</td></tr>
                <tr><td><code>valid_until</code></td><td>date</td><td>Fecha validez</td></tr>
                <tr><td><code>delivery_date</code></td><td>date</td><td>Fecha entrega</td></tr>
            </tbody>
        </table>

        <h4>M√©todos Clave Document</h4>
        <pre data-language="php">public function calculateTotals(): void    // Recalcula totales autom√°ticamente
public function generateNumber(): string   // Genera n√∫mero √∫nico secuencial
public function canBeEdited(): bool       // Verifica si se puede editar</pre>

        <h4>Modelo DocumentItem (Polim√≥rfico)</h4>
        <div class="warning">
            <strong>Sistema Polim√≥rfico Central</strong> - Un DocumentItem puede contener cualquier tipo de item: SimpleItem, Product, DigitalItem, TalonarioItem, MagazineItem
        </div>

        <table>
            <thead>
                <tr>
                    <th>Campo</th>
                    <th>Tipo</th>
                    <th>Descripci√≥n</th>
                </tr>
            </thead>
            <tbody>
                <tr><td><code>id</code></td><td>bigint</td><td>Clave primaria</td></tr>
                <tr><td><code>document_id</code></td><td>bigint</td><td>FK: Documento</td></tr>
                <tr><td><code>itemable_type</code></td><td>string</td><td>Tipo polim√≥rfico</td></tr>
                <tr><td><code>itemable_id</code></td><td>bigint</td><td>ID polim√≥rfico</td></tr>
                <tr><td><code>description</code></td><td>string</td><td>Descripci√≥n del item</td></tr>
                <tr><td><code>quantity</code></td><td>integer</td><td>Cantidad solicitada</td></tr>
                <tr><td><code>unit_price</code></td><td>decimal</td><td>Precio unitario</td></tr>
                <tr><td><code>total_price</code></td><td>decimal</td><td>Precio total</td></tr>
            </tbody>
        </table>

        <h4>Relaci√≥n Polim√≥rfica</h4>
        <pre data-language="php">public function itemable(): MorphTo // morphTo() -> SimpleItem, Product, DigitalItem, TalonarioItem, MagazineItem
public function document(): BelongsTo // belongsTo(Document::class)</pre>

        <h4>M√©todos Especializados</h4>
        <pre data-language="php">public function calculateAndUpdatePrices(): bool  // Auto-c√°lculo por tipo
public static function fixZeroPrices(): int       // Correcci√≥n masiva precios 0</pre>

        <h3><span class="emoji">üìã</span>SimpleItem - Items B√°sicos</h3>
        <table>
            <thead>
                <tr>
                    <th>Campo</th>
                    <th>Tipo</th>
                    <th>Descripci√≥n</th>
                </tr>
            </thead>
            <tbody>
                <tr><td><code>id</code></td><td>bigint</td><td>Clave primaria</td></tr>
                <tr><td><code>company_id</code></td><td>bigint</td><td>FK: Multi-tenancy</td></tr>
                <tr><td><code>description</code></td><td>string</td><td>Descripci√≥n del trabajo</td></tr>
                <tr><td><code>quantity</code></td><td>integer</td><td>Cantidad a producir</td></tr>
                <tr><td><code>horizontal_size</code></td><td>decimal</td><td>Ancho en cm</td></tr>
                <tr><td><code>vertical_size</code></td><td>decimal</td><td>Alto en cm</td></tr>
                <tr><td><code>paper_id</code></td><td>bigint</td><td>FK: Papel seleccionado</td></tr>
                <tr><td><code>printing_machine_id</code></td><td>bigint</td><td>FK: M√°quina impresi√≥n</td></tr>
                <tr><td><code>ink_front_count</code></td><td>integer</td><td>Tintas frente (1-4)</td></tr>
                <tr><td><code>ink_back_count</code></td><td>integer</td><td>Tintas reverso (0-4)</td></tr>
                <tr><td><code>front_back_plate</code></td><td>boolean</td><td>Placa frente y reverso</td></tr>
                <tr><td><code>design_value</code></td><td>decimal</td><td>Costo dise√±o</td></tr>
                <tr><td><code>transport_value</code></td><td>decimal</td><td>Costo transporte</td></tr>
                <tr><td><code>rifle_value</code></td><td>decimal</td><td>Costo rifle/troquelado</td></tr>
                <tr><td><code>profit_percentage</code></td><td>decimal</td><td>Margen ganancia %</td></tr>
            </tbody>
        </table>

        <div class="success">
            <strong>C√°lculos Autom√°ticos con CuttingCalculatorService:</strong>
            <ul>
                <li>Optimizaci√≥n de cortes por pliego</li>
                <li>C√°lculo de desperdicios</li>
                <li>Determinaci√≥n orientaci√≥n √≥ptima</li>
                <li>C√°lculo costos papel e impresi√≥n</li>
            </ul>
        </div>

        <h3><span class="emoji">üíª</span>DigitalItem - Servicios Digitales</h3>
        <table>
            <thead>
                <tr>
                    <th>Campo</th>
                    <th>Tipo</th>
                    <th>Descripci√≥n</th>
                </tr>
            </thead>
            <tbody>
                <tr><td><code>id</code></td><td>bigint</td><td>Clave primaria</td></tr>
                <tr><td><code>company_id</code></td><td>bigint</td><td>FK: Multi-tenancy</td></tr>
                <tr><td><code>code</code></td><td>string</td><td>C√≥digo auto-generado</td></tr>
                <tr><td><code>description</code></td><td>string</td><td>Descripci√≥n servicio</td></tr>
                <tr><td><code>quantity</code></td><td>integer</td><td>Cantidad</td></tr>
                <tr><td><code>pricing_type</code></td><td>enum</td><td>Tipo: 'unit' o 'size'</td></tr>
                <tr><td><code>unit_value</code></td><td>decimal</td><td>Valor unitario o por m¬≤</td></tr>
                <tr><td><code>width</code></td><td>decimal</td><td>Ancho (para tipo 'size')</td></tr>
                <tr><td><code>height</code></td><td>decimal</td><td>Alto (para tipo 'size')</td></tr>
                <tr><td><code>design_value</code></td><td>decimal</td><td>Costo dise√±o adicional</td></tr>
                <tr><td><code>profit_percentage</code></td><td>decimal</td><td>Margen ganancia %</td></tr>
            </tbody>
        </table>

        <h4>C√°lculo Dual</h4>
        <pre data-language="php">// Tipo 'unit': Precio fijo por cantidad
$total = $unit_value * $quantity;

// Tipo 'size': Precio por metro cuadrado
$area = ($width/100) * ($height/100); // cm a metros
$total = $area * $unit_value * $quantity;</pre>

        <hr class="section-divider">

        <h2 id="servicios"><span class="emoji">‚öôÔ∏è</span>Servicios Calculadores</h2>

        <h3><span class="emoji">üîß</span>CuttingCalculatorService</h3>
        <div class="highlight">
            <strong>Responsabilidad:</strong> Optimizaci√≥n de cortes y c√°lculo de costos para SimpleItems.
        </div>

        <pre data-language="php">class CuttingCalculatorService
{
    public function calculateOptimalCutting(SimpleItem $item): array
    {
        // 1. Obtener dimensiones papel y item
        // 2. Calcular orientaciones posibles
        // 3. Determinar cortes √≥ptimos
        // 4. Calcular desperdicios
        // 5. Retornar configuraci√≥n √≥ptima
    }

    public function calculateCosts(SimpleItem $item): array
    {
        // 1. Costo papel = (pliegos_necesarios * precio_pliego)
        // 2. Costo impresi√≥n = (pliegos * costo_por_pliego_por_color)
        // 3. Costo tintas frente + reverso
        // 4. Aplicar margen de ganancia
    }
}</pre>

        <h3><span class="emoji">üßÆ</span>TalonarioCalculatorService</h3>
        <div class="highlight">
            <strong>Responsabilidad:</strong> C√°lculo complejo de talonarios con hojas y acabados.
        </div>

        <pre data-language="php">class TalonarioCalculatorService
{
    public function calculateAll(TalonarioItem $talonario): array
    {
        // 1. Calcular costo total de hojas
        // 2. Calcular costo encuadernaci√≥n
        // 3. Calcular costo acabados seg√∫n tipo
        // 4. Aplicar costos adicionales y margen
    }

    public function calculateFinishingCost(TalonarioItem $talonario, Finishing $finishing): float
    {
        if ($finishing->measurement_unit === FinishingMeasurementUnit::POR_NUMERO) {
            $totalNumbers = ($talonario->numero_final - $talonario->numero_inicial) + 1;
            return $totalNumbers * $talonario->quantity * $finishing->unit_price;
        } else {
            $totalTalonarios = ceil($totalNumbers / $talonario->numeros_por_talonario);
            return $totalTalonarios * $talonario->quantity * $finishing->unit_price;
        }
    }
}</pre>

        <h3><span class="emoji">üìä</span>DigitalItemCalculatorService</h3>
        <div class="highlight">
            <strong>Responsabilidad:</strong> C√°lculo de servicios digitales con pricing dual.
        </div>

        <pre data-language="php">class DigitalItemCalculatorService
{
    public function calculate(DigitalItem $item): array
    {
        if ($item->pricing_type === 'unit') {
            $subtotal = $item->unit_value * $item->quantity;
        } else { // 'size'
            $area = ($item->width / 100) * ($item->height / 100);
            $subtotal = $area * $item->unit_value * $item->quantity;
        }

        $total = $subtotal + $item->design_value;
        $finalPrice = $total * (1 + $item->profit_percentage / 100);

        return compact('subtotal', 'total', 'finalPrice');
    }
}</pre>

        <hr class="section-divider">

        <h2 id="filament"><span class="emoji">üéõÔ∏è</span>An√°lisis de Filament Resources</h2>

        <h3><span class="emoji">üìÅ</span>Arquitectura Optimizada con Patr√≥n Strategy</h3>

        <div class="warning">
            <strong>Problema Resuelto:</strong> El DocumentItemsRelationManager original ten√≠a 4,020 l√≠neas de c√≥digo duplicado.<br>
            <strong>Soluci√≥n:</strong> Refactorizaci√≥n con patr√≥n Strategy redujo a 403 l√≠neas (<strong>90% menos c√≥digo</strong>).
        </div>

        <h4>Estructura Optimizada:</h4>
        <pre data-language="text">app/Filament/Resources/Documents/RelationManagers/
‚îú‚îÄ‚îÄ DocumentItemsRelationManager.php  (Orchestrator - 403 l√≠neas)
‚îî‚îÄ‚îÄ Handlers/
    ‚îú‚îÄ‚îÄ AbstractItemHandler.php      (Base abstracta)
    ‚îú‚îÄ‚îÄ ItemHandlerFactory.php       (Factory pattern)
    ‚îú‚îÄ‚îÄ SimpleItemHandler.php        (SimpleItem espec√≠fico)
    ‚îú‚îÄ‚îÄ ProductHandler.php           (Product espec√≠fico)
    ‚îú‚îÄ‚îÄ DigitalItemHandler.php       (DigitalItem espec√≠fico)
    ‚îú‚îÄ‚îÄ TalonarioItemHandler.php     (TalonarioItem espec√≠fico)
    ‚îî‚îÄ‚îÄ MagazineItemHandler.php      (MagazineItem espec√≠fico)</pre>

        <h4>AbstractItemHandler:</h4>
        <pre data-language="php">abstract class AbstractItemHandler
{
    abstract public function getCreateForm(): array;
    abstract public function getEditForm(): array;
    abstract public function getTableColumns(): array;
    abstract public function handleCreate(array $data, Document $document): DocumentItem;
    abstract public function handleUpdate(DocumentItem $item, array $data): void;

    protected function calculatePrices(array $data): array
    {
        // L√≥gica com√∫n de c√°lculo de precios
    }
}</pre>

        <h4>ItemHandlerFactory:</h4>
        <pre data-language="php">class ItemHandlerFactory
{
    public static function make(string $type): AbstractItemHandler
    {
        return match($type) {
            'simple_item' => new SimpleItemHandler(),
            'product' => new ProductHandler(),
            'digital_item' => new DigitalItemHandler(),
            'talonario_item' => new TalonarioItemHandler(),
            'magazine_item' => new MagazineItemHandler(),
            default => throw new InvalidArgumentException("Unknown item type: {$type}")
        };
    }
}</pre>

        <hr class="section-divider">

        <h2 id="testing"><span class="emoji">üß™</span>An√°lisis de Testing</h2>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">60+</div>
                <div class="stat-label">Total Tests</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">95%+</div>
                <div class="stat-label">Coverage</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">14</div>
                <div class="stat-label">Unit Tests Cutting</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">15</div>
                <div class="stat-label">Unit Tests Calculator</div>
            </div>
        </div>

        <h3><span class="emoji">üìä</span>Suite de Testing</h3>

        <h4>Unit Tests - Servicios Calculadores</h4>
        <pre data-language="php">// tests/Unit/Services/CuttingCalculatorServiceTest.php (14 tests)
class CuttingCalculatorServiceTest extends TestCase
{
    /** @test */
    public function calculates_optimal_cutting_for_business_cards()
    {
        $item = SimpleItem::factory()->businessCard()->make();
        $result = $this->service->calculateOptimalCutting($item);

        $this->assertEquals(10, $result['cuts_per_sheet']);
        $this->assertEquals('horizontal', $result['orientation']);
        $this->assertLessThan(5, $result['waste_percentage']);
    }
}</pre>

        <h4>Feature Tests - Workflows Completos</h4>
        <pre data-language="php">// tests/Feature/MultiTenantIsolationTest.php (11 tests)
class MultiTenantIsolationTest extends TestCase
{
    /** @test */
    public function tenant_data_isolation_is_enforced()
    {
        $company1 = Company::factory()->create();
        $company2 = Company::factory()->create();

        $user1 = User::factory()->for($company1)->create();
        $user2 = User::factory()->for($company2)->create();

        // Datos empresa 1
        $this->actingAs($user1);
        $document1 = Document::factory()->create();

        // Datos empresa 2
        $this->actingAs($user2);
        $document2 = Document::factory()->create();

        // Verificar aislamiento
        $this->assertEquals(1, Document::count()); // Solo ve su documento
        $this->assertNotEquals($document1->id, $document2->id);
    }
}</pre>

        <div class="success">
            <h4>Testing Coverage</h4>
            <ul>
                <li><strong>Models:</strong> 100% m√©todos p√∫blicos</li>
                <li><strong>Services:</strong> 95% l√≥gica de negocio</li>
                <li><strong>Features:</strong> 90% workflows principales</li>
                <li><strong>Multi-tenancy:</strong> 100% aislamiento de datos</li>
            </ul>
        </div>

        <hr class="section-divider">

        <h2 id="metricas"><span class="emoji">üìä</span>M√©tricas y Rendimiento</h2>

        <h3><span class="emoji">üìà</span>Estad√≠sticas del Proyecto</h3>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">32+</div>
                <div class="stat-label">Modelos Principales</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">45+</div>
                <div class="stat-label">Migraciones</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">60+</div>
                <div class="stat-label">Tests</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">6</div>
                <div class="stat-label">Servicios</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">15,000+</div>
                <div class="stat-label">L√≠neas de C√≥digo</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">90%</div>
                <div class="stat-label">Reducci√≥n C√≥digo</div>
            </div>
        </div>

        <h3><span class="emoji">‚ö°</span>Optimizaciones Implementadas</h3>

        <div class="highlight">
            <h4>1. √çndices de Base de Datos:</h4>
            <ul>
                <li>Multi-column indexes para multi-tenancy</li>
                <li>√çndices compuestos para queries frecuentes</li>
                <li>Foreign keys con cascada optimizada</li>
            </ul>
        </div>

        <div class="highlight">
            <h4>2. Patr√≥n Strategy en Filament:</h4>
            <ul>
                <li>Reducci√≥n 90% c√≥digo duplicado</li>
                <li>Mantenibilidad mejorada</li>
                <li>Extensibilidad para nuevos tipos</li>
            </ul>
        </div>

        <div class="highlight">
            <h4>3. Caching Inteligente:</h4>
            <ul>
                <li>Cache de c√°lculos complejos</li>
                <li>Invalidaci√≥n autom√°tica en cambios</li>
                <li>Session storage para temporales</li>
            </ul>
        </div>

        <div class="highlight">
            <h4>4. Lazy Loading Optimizado:</h4>
            <ul>
                <li>Eager loading en relaciones cr√≠ticas</li>
                <li>Paginaci√≥n eficiente en tablas grandes</li>
                <li>Queries N+1 eliminadas</li>
            </ul>
        </div>

        <hr class="section-divider">

        <h2 id="roadmap"><span class="emoji">üîÆ</span>Roadmap y Mejoras Futuras</h2>

        <h3><span class="emoji">üéØ</span>Pr√≥ximas Caracter√≠sticas</h3>

        <div class="highlight">
            <h4>1. Sistema de Inventario Avanzado:</h4>
            <ul>
                <li>Alertas autom√°ticas stock bajo</li>
                <li>Reportes movimientos inventario</li>
                <li>Integraci√≥n proveedores autom√°tica</li>
                <li>Dashboard inventario con m√©tricas</li>
            </ul>
        </div>

        <div class="highlight">
            <h4>2. M√≥dulo de Producci√≥n:</h4>
            <ul>
                <li>Workflow estados producci√≥n</li>
                <li>Asignaci√≥n recursos y operarios</li>
                <li>Tracking tiempo real</li>
                <li>Reportes eficiencia</li>
            </ul>
        </div>

        <div class="highlight">
            <h4>3. API REST Completa:</h4>
            <ul>
                <li>Endpoints CRUD completos</li>
                <li>Autenticaci√≥n JWT</li>
                <li>Rate limiting</li>
                <li>Documentaci√≥n OpenAPI</li>
            </ul>
        </div>

        <div class="highlight">
            <h4>4. Mobile App Companion:</h4>
            <ul>
                <li>Consulta cotizaciones</li>
                <li>Aprobaci√≥n m√≥vil</li>
                <li>Notificaciones push</li>
                <li>C√°mara para mediciones</li>
            </ul>
        </div>

        <h3><span class="emoji">üîß</span>Refactorizaciones Pendientes</h3>
        <ul>
            <li><strong>Event Sourcing</strong> para auditor√≠a completa</li>
            <li><strong>Queue Jobs</strong> para procesos pesados</li>
            <li><strong>Redis Caching</strong> para rendimiento</li>
            <li><strong>Elasticsearch</strong> para b√∫squedas avanzadas</li>
        </ul>

        <hr class="section-divider">

        <h2 id="conclusiones"><span class="emoji">‚úÖ</span>Conclusiones</h2>

        <p>LitoPro 3.0 representa una soluci√≥n SaaS robusta y escalable para el sector litogr√°fico, con:</p>

        <h3><span class="emoji">üèÜ</span>Fortalezas Principales</h3>
        <div class="success">
            <ul>
                <li><strong>Arquitectura S√≥lida:</strong> Multi-tenancy + Polimorfismo bien implementado</li>
                <li><strong>Testing Robusto:</strong> 60+ tests garantizan estabilidad</li>
                <li><strong>C√≥digo Optimizado:</strong> Reducci√≥n 90% duplicaci√≥n con patrones SOLID</li>
                <li><strong>UX Excepcional:</strong> Dashboard interactivo + calculadoras visuales</li>
            </ul>
        </div>

        <h3><span class="emoji">üéØ</span>Casos de Uso Cubiertos</h3>
        <div class="success">
            <ul>
                <li>‚úÖ Cotizaciones complejas con m√∫ltiples tipos de items</li>
                <li>‚úÖ Inventario y control de stock automatizado</li>
                <li>‚úÖ C√°lculos autom√°ticos de optimizaci√≥n y precios</li>
                <li>‚úÖ Multi-tenancy con aislamiento completo de datos</li>
                <li>‚úÖ Dashboard ejecutivo con m√©tricas en tiempo real</li>
            </ul>
        </div>

        <h3><span class="emoji">üöÄ</span>Escalabilidad</h3>
        <p>El sistema est√° preparado para:</p>
        <div class="highlight">
            <ul>
                <li><strong>Crecimiento horizontal:</strong> Arquitectura multi-tenant</li>
                <li><strong>Nuevos tipos de items:</strong> Patr√≥n polim√≥rfico extensible</li>
                <li><strong>Integraciones:</strong> API REST foundation lista</li>
                <li><strong>Performance:</strong> Optimizaciones de base de datos implementadas</li>
            </ul>
        </div>

        <div class="success" style="text-align: center; font-size: 1.2em; margin-top: 40px;">
            <strong>LitoPro 3.0 es una base s√≥lida para el crecimiento del negocio de litograf√≠as en el mercado SaaS.</strong>
        </div>
    </div>

    <script>
        // Smooth scrolling para enlaces internos
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Agregar efecto hover a las tablas
        document.querySelectorAll('table tr').forEach(row => {
            row.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.01)';
                this.style.transition = 'transform 0.2s ease';
            });
            row.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
        });

        // Agregar tooltip a c√≥digo
        document.querySelectorAll('code').forEach(code => {
            code.title = 'C√≥digo: ' + code.textContent;
        });
    </script>
</body>
</html>