# Agregar temporalmente al final de routes/web.php:

Route::get('/admin/clean-test-data-temp', function() {
    if (app()->environment() !== 'production') {
        abort(403, 'Solo en producciÃ³n');
    }
    
    // Verificar token de seguridad
    if (request()->query('token') !== 'GrafiRed2026Clean') {
        abort(403, 'Token invÃ¡lido');
    }
    
    try {
        DB::statement('SET FOREIGN_KEY_CHECKS=0;');
        
        \App\Models\CollectionAccount::truncate();
        DB::table('document_item_production_order')->delete();
        \App\Models\ProductionOrder::query()->delete();
        DB::table('purchase_order_items')->delete();
        \App\Models\PurchaseOrder::query()->delete();
        DB::table('document_items')->delete();
        \App\Models\Document::query()->delete();
        \App\Models\User::whereNotNull('company_id')->delete();
        \App\Models\Company::query()->delete();
        
        DB::statement('SET FOREIGN_KEY_CHECKS=1;');
        
        // Ejecutar seeder
        Artisan::call('db:seed', [
            '--class' => 'MinimalProductionSeeder',
            '--force' => true
        ]);
        
        return response()->json([
            'success' => true,
            'message' => 'Datos de prueba eliminados y seeder ejecutado',
            'companies_count' => \App\Models\Company::count(),
            'plans_count' => \App\Models\Plan::count(),
        ]);
    } catch (\Exception $e) {
        return response()->json([
            'success' => false,
            'error' => $e->getMessage()
        ], 500);
    }
})->name('admin.clean-test-data-temp');
