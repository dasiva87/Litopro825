â— ğŸš€ GuÃ­a de Desarrollo Independiente - LitoPro 3.0

  ğŸ“š Fundamentos TÃ©cnicos

  Stack TecnolÃ³gico

  # Versiones exactas del proyecto
  Laravel: 10.x
  Filament: 4.x
  PHP: 8.2+
  MySQL: 8.0+
  Node.js: 18+ (para assets)

  Comandos Esenciales

  # Desarrollo diario
  php artisan serve                    # Servidor local
  php artisan migrate                  # Ejecutar migraciones
  php artisan db:seed                  # Poblar datos
  php artisan queue:work              # Procesar colas
  php artisan optimize:clear          # Limpiar cache

  # Filament especÃ­ficos
  php artisan make:filament-resource ModelName
  php artisan make:filament-page PageName
  php artisan make:filament-widget WidgetName
  php artisan filament:optimize       # Optimizar Filament

  ğŸ—‚ï¸ Estructura del Proyecto

  Convenciones de Archivos

  app/
  â”œâ”€â”€ Enums/                     # Enums del sistema
  â”œâ”€â”€ Models/                    # Modelos Eloquent
  â”œâ”€â”€ Filament/
  â”‚   â”œâ”€â”€ Resources/            # CRUD Resources
  â”‚   â”œâ”€â”€ Pages/               # PÃ¡ginas personalizadas
  â”‚   â”œâ”€â”€ Widgets/            # Dashboard widgets
  â”‚   â””â”€â”€ Clusters/           # Agrupaciones de resources
  â”œâ”€â”€ Services/               # LÃ³gica de negocio
  â”œâ”€â”€ Policies/              # PolÃ­ticas de autorizaciÃ³n
  â””â”€â”€ Http/
      â”œâ”€â”€ Controllers/       # Controladores tradicionales
      â””â”€â”€ Middleware/       # Middleware personalizado

  ğŸ¯ Patrones de Desarrollo

  1. Crear un Nuevo MÃ³dulo

  Paso 1: Crear el Modelo

  // app/Models/Invoice.php
  <?php
  namespace App\Models;

  use Illuminate\Database\Eloquent\Model;
  use Illuminate\Database\Eloquent\SoftDeletes;
  use App\Models\Scopes\CompanyScope;

  class Invoice extends Model
  {
      use SoftDeletes;

      protected $fillable = [
          'company_id', 'document_id', 'invoice_number',
          // ... mÃ¡s campos
      ];

      protected $casts = [
          'date' => 'date',
          'amount' => 'decimal:2',
          'is_paid' => 'boolean',
      ];

      // SIEMPRE incluir CompanyScope para multi-tenancy
      protected static function boot()
      {
          parent::boot();
          static::addGlobalScope(new CompanyScope);
      }

      // Relaciones
      public function company(): BelongsTo
      {
          return $this->belongsTo(Company::class);
      }

      // Scopes Ãºtiles
      public function scopePaid($query)
      {
          return $query->where('is_paid', true);
      }

      // MÃ©todos de negocio
      public function markAsPaid(): bool
      {
          $this->is_paid = true;
          return $this->save();
      }
  }

  Paso 2: Crear la MigraciÃ³n

  // database/migrations/xxxx_create_invoices_table.php
  Schema::create('invoices', function (Blueprint $table) {
      $table->id();
      $table->foreignId('company_id')->constrained()->cascadeOnDelete();
      $table->foreignId('document_id')->nullable()->constrained();
      $table->string('invoice_number')->unique();
      $table->date('date');
      $table->decimal('amount', 10, 2);
      $table->boolean('is_paid')->default(false);
      $table->timestamps();
      $table->softDeletes();

      // Ãndices importantes
      $table->index(['company_id', 'is_paid']);
      $table->index(['company_id', 'date']);
  });

  Paso 3: Crear el Resource de Filament

  php artisan make:filament-resource Invoice --generate

  // app/Filament/Resources/InvoiceResource.php
  <?php
  namespace App\Filament\Resources;

  use App\Enums\NavigationGroup;
  use BackedEnum;

  class InvoiceResource extends Resource
  {
      protected static ?string $model = Invoice::class;
      protected static BackedEnum|string|null $navigationIcon = 'heroicon-o-currency-dollar';
      protected static NavigationGroup|string|null $navigationGroup = NavigationGroup::Cotizaciones;
      protected static ?int $navigationSort = 3;

      public static function form(Form $form): Form
      {
          return $form->schema([
              // Usar secciones para organizar
              Forms\Components\Section::make('InformaciÃ³n Principal')
                  ->schema([
                      // Campos del formulario
                  ]),
          ]);
      }

      public static function table(Table $table): Table
      {
          return $table
              ->columns([
                  // Columnas de la tabla
              ])
              ->filters([
                  // Filtros Ãºtiles
              ])
              ->actions([
                  // Acciones por registro
              ]);
      }
  }

  2. Integrar con Calculadora de Cortes

  // En tu modelo DocumentItem o similar
  use App\Services\CuttingCalculatorService;

  public function calculateCuttingOptimization(): array
  {
      if (!$this->paper || !$this->width || !$this->height) {
          return [];
      }

      $calculator = new CuttingCalculatorService();

      try {
          return $calculator->calculateCuts(
              paperWidth: $this->paper->width,
              paperHeight: $this->paper->height,
              cutWidth: $this->width,
              cutHeight: $this->height,
              desiredCuts: (int) $this->quantity,
              orientation: $this->orientation ?? 'horizontal'
          );
      } catch (\Exception $e) {
          \Log::error('Error en cÃ¡lculo de cortes: ' . $e->getMessage());
          return [];
      }
  }

  3. Crear PÃ¡ginas Personalizadas

  // app/Filament/Pages/Reports.php
  <?php
  namespace App\Filament\Pages;

  use Filament\Pages\Page;
  use App\Enums\NavigationGroup;

  class Reports extends Page
  {
      protected static NavigationGroup|string|null $navigationGroup = NavigationGroup::Sistema;
      protected static ?string $navigationIcon = 'heroicon-o-chart-bar';
      protected static string $view = 'filament.pages.reports';

      // Propiedades pÃºblicas para Livewire
      public $startDate;
      public $endDate;
      public $reportData = [];

      public function mount(): void
      {
          $this->startDate = now()->startOfMonth()->format('Y-m-d');
          $this->endDate = now()->format('Y-m-d');
          $this->generateReport();
      }

      public function generateReport(): void
      {
          // LÃ³gica del reporte
          $this->reportData = Document::query()
              ->whereBetween('created_at', [$this->startDate, $this->endDate])
              ->selectRaw('status, COUNT(*) as count, SUM(total) as total')
              ->groupBy('status')
              ->get();
      }
  }

  ğŸ› ï¸ Herramientas de Desarrollo

  Debugging

  // En desarrollo, usar:
  dd($variable);              // Dump and die
  dump($variable);           // Dump sin parar
  logger('Debug info', $data); // Log personalizado

  // En Filament Resources:
  \Filament\Notifications\Notification::make()
      ->title('TÃ­tulo')
      ->body('Mensaje')
      ->success() // o ->danger(), ->warning()
      ->send();

  Testing

  # Ejecutar tests
  php artisan test
  php artisan test --filter InvoiceTest

  # Crear tests
  php artisan make:test InvoiceTest
  php artisan make:test InvoiceTest --unit

  Base de Datos

  # Migraciones
  php artisan make:migration create_invoices_table
  php artisan migrate:rollback --step=1
  php artisan migrate:refresh --seed

  # Seeders
  php artisan make:seeder InvoiceSeeder
  php artisan db:seed --class=InvoiceSeeder

  # Factory
  php artisan make:factory InvoiceFactory

  ğŸ“‹ Lista de VerificaciÃ³n para Nuevas Funcionalidades

  âœ… Checklist Completo

  PreparaciÃ³n

  - Definir requerimientos claros
  - DiseÃ±ar esquema de base de datos
  - Identificar relaciones con modelos existentes
  - Planificar flujo de usuario

  Desarrollo Backend

  - Crear migraciÃ³n con Ã­ndices apropiados
  - Crear modelo con CompanyScope
  - Definir relaciones Eloquent
  - Crear Factory para testing
  - Escribir tests unitarios bÃ¡sicos

  Desarrollo Frontend (Filament)

  - Crear Resource con form() y table()
  - Configurar navegaciÃ³n y permisos
  - Agregar filtros y bÃºsqueda
  - Implementar acciones personalizadas
  - Probar responsividad

  IntegraciÃ³n

  - Conectar con servicios existentes
  - Validar cÃ¡lculos automÃ¡ticos
  - Probar flujo completo
  - Verificar multi-tenancy
  - Documentar cambios

  ğŸš¨ Errores Comunes y Soluciones

  1. Error de Multi-tenancy

  Problem: Datos de otra empresa aparecen
  Solution: Verificar que CompanyScope estÃ© aplicado

  2. Error de Tipos en Filament v4

  // âŒ Incorrecto
  protected static ?string $navigationIcon = 'heroicon-o-users';
  protected static ?string $navigationGroup = 'Sistema';

  // âœ… Correcto
  protected static BackedEnum|string|null $navigationIcon = 'heroicon-o-users';
  protected static NavigationGroup|string|null $navigationGroup = NavigationGroup::Sistema;

  3. Error en Relaciones

  // âŒ Incorrecto - Sin constrained()
  $table->foreignId('company_id');

  // âœ… Correcto - Con cascada
  $table->foreignId('company_id')->constrained()->cascadeOnDelete();

  4. Error en CÃ¡lculos

  // âŒ Incorrecto - Sin validaciones
  public function calculateTotal()
  {
      return $this->quantity * $this->price;
  }

  // âœ… Correcto - Con validaciones
  public function calculateTotal(): float
  {
      if (!$this->quantity || !$this->price) {
          return 0.0;
      }
      return (float) ($this->quantity * $this->price);
  }

  ğŸ“– Recursos de Aprendizaje

  DocumentaciÃ³n Oficial

  - Laravel: https://laravel.com/docs/10.x
  - Filament: https://filamentphp.com/docs/3.x
  - PHP: https://www.php.net/docs.php

  Patrones Ãštiles

  // Service Pattern para lÃ³gica compleja
  class InvoiceService 
  {
      public function generateFromDocument(Document $document): Invoice
      {
          // LÃ³gica de conversiÃ³n
      }
  }

  // Repository Pattern para consultas complejas
  class DocumentRepository
  {
      public function getExpiringSoon(int $days = 7): Collection
      {
          return Document::query()
              ->where('valid_until', '<=', now()->addDays($days))
              ->where('status', 'sent')
              ->get();
      }
  }

  // Observer Pattern para eventos
  class DocumentObserver
  {
      public function created(Document $document): void
      {
          // LÃ³gica despuÃ©s de crear documento
      }
  }

  Tips de Performance

  // Usar eager loading para evitar N+1
  $documents = Document::with(['contact', 'items.paper'])->get();

  // Cachear consultas costosas
  $expensiveData = Cache::remember('reports.monthly', 3600, function () {
      return Document::complexQuery()->get();
  });

  // Usar chunks para procesar grandes datasets
  Document::chunk(100, function ($documents) {
      foreach ($documents as $document) {
          // Procesar documento
      }
  });

  ğŸ¯ Flujo de Desarrollo Recomendado

  1. PlanificaciÃ³n (30 min)

  - Definir requerimientos
  - Revisar modelos existentes
  - Planificar integraciones

  2. Base de Datos (45 min)

  - Crear migraciÃ³n
  - Crear modelo con relaciones
  - Ejecutar y verificar

  3. Resource Filament (60 min)

  - Crear resource bÃ¡sico
  - Configurar formulario
  - Configurar tabla con filtros

  4. IntegraciÃ³n (30 min)

  - Conectar con servicios
  - Probar cÃ¡lculos
  - Verificar permisos

  5. Testing (30 min)

  - Probar flujo completo
  - Verificar edge cases
  - Documentar cambios

  ---
  ğŸš€ Â¡EstÃ¡s Listo!

  Con esta guÃ­a tienes todo lo necesario para:
  - âœ… Crear nuevos mÃ³dulos siguiendo patrones establecidos
  - âœ… Integrar con la calculadora de cortes existente
  - âœ… Mantener consistencia en el cÃ³digo
  - âœ… Evitar errores comunes
  - âœ… Desarrollar con confianza

  Â¡Ã‰xito en tu desarrollo independiente! ğŸ’ª
