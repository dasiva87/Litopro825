; Configuración de Supervisor para GrafiRed 3.0
; =============================================
; Este archivo configura el queue worker para procesar emails y PDFs en background.
;
; INSTALACIÓN:
; 1. Instalar Redis: sudo apt install redis-server php8.3-redis
; 2. Instalar Supervisor: sudo apt install supervisor
; 3. Copiar este archivo: sudo cp supervisor.conf /etc/supervisor/conf.d/grafired.conf
; 4. Actualizar rutas según tu instalación
; 5. Recargar supervisor: sudo supervisorctl reread && sudo supervisorctl update
;
; VERIFICACIÓN:
; - sudo supervisorctl status
; - php artisan queue:monitor
;
; ANTES DE ACTIVAR:
; 1. Cambiar en .env: QUEUE_CONNECTION=redis
; 2. Ejecutar: php artisan config:clear

[program:grafired-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /home/dasiva/Descargas/litopro825/artisan queue:work redis --queue=emails,pdfs,default --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/home/dasiva/Descargas/litopro825/storage/logs/worker.log
stdout_logfile_maxbytes=10MB
stopwaitsecs=3600

; Worker adicional para tareas pesadas (PDFs)
[program:grafired-pdf-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /home/dasiva/Descargas/litopro825/artisan queue:work redis --queue=pdfs --sleep=3 --tries=3 --max-time=3600 --memory=256
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/home/dasiva/Descargas/litopro825/storage/logs/pdf-worker.log
stdout_logfile_maxbytes=10MB
stopwaitsecs=3600
