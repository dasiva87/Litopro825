<?php

namespace Database\Seeders;

use App\Models\Company;
use App\Models\SocialPost;
use App\Models\SocialComment;
use App\Models\SocialLike;
use App\Models\SocialConnection;
use App\Models\User;
use Illuminate\Database\Seeder;

class SocialNetworkDemoSeeder extends Seeder
{
    public function run(): void
    {
        // Get demo company and user
        $company = Company::where('name', 'LitoPro Demo')->first();
        $user = User::where('email', 'demo@litopro.test')->first();
        
        if (!$company || !$user) {
            $this->command->info('‚ö†Ô∏è  Demo company or user not found. Run setup demo first.');
            return;
        }
        
        // Create some additional demo companies for social interactions
        $companies = collect([
            [
                'name' => 'Papeler√≠a Central',
                'email' => 'admin@papeleriacentral.com',
                'phone' => '+57 301 234 5678',
                'address' => 'Carrera 45 #67-89, Medell√≠n',
                'is_active' => true,
            ],
            [
                'name' => 'Impresos del Norte',
                'email' => 'info@impresosnorte.co',
                'phone' => '+57 302 345 6789',
                'address' => 'Calle 123 #45-67, Barranquilla',
                'is_active' => true,
            ],
            [
                'name' => 'Gr√°ficas Modernas',
                'email' => 'contacto@graficasmodernas.com',
                'phone' => '+57 303 456 7890',
                'address' => 'Avenida 68 #123-45, Bogot√°',
                'is_active' => true,
            ]
        ]);
        
        $createdCompanies = [];
        foreach ($companies as $companyData) {
            $newCompany = Company::firstOrCreate(['name' => $companyData['name']], $companyData);
            $createdCompanies[] = $newCompany;
            
            // Create a user for each company
            User::firstOrCreate([
                'email' => str_replace('@', '_admin@', $companyData['email']),
            ], [
                'name' => 'Admin ' . $companyData['name'],
                'password' => bcrypt('password'),
                'company_id' => $newCompany->id,
                'is_active' => true,
            ]);
        }
        
        // Create social posts with different types
        $posts = [
            [
                'company_id' => $company->id,
                'user_id' => $user->id,
                'post_type' => 'news',
                'title' => 'Excelente mes de ventas',
                'content' => 'üéâ ¬°Excelente mes de junio! Hemos superado nuestra meta de ventas en un 23%. Gracias a todos nuestros clientes que conf√≠an en nosotros para sus proyectos de impresi√≥n. ¬°Seguimos creciendo juntos! üìà‚ú®',
                'is_public' => true,
                'created_at' => now()->subHours(2),
                'updated_at' => now()->subHours(2),
            ],
            [
                'company_id' => $createdCompanies[0]->id,
                'user_id' => $createdCompanies[0]->users->first()->id,
                'post_type' => 'materials',
                'title' => 'Oferta Especial - Papel Couch√©',
                'content' => 'üì¶ NUEVA LLEGADA: Papel couch√© brillante 150g de excelente calidad. Stock limitado con 15% de descuento para pedidos mayores a 200 pliegos. ¬°Aprovecha esta oferta especial! üéâ',
                'is_public' => true,
                'created_at' => now()->subHours(4),
                'updated_at' => now()->subHours(4),
            ],
            [
                'company_id' => $company->id,
                'user_id' => $user->id,
                'post_type' => 'news',
                'title' => 'Trabajo terminado - 50k volantes',
                'content' => '‚úÖ ¬°Trabajo terminado! Acabamos de finalizar la impresi√≥n de 50,000 volantes para la campa√±a de verano del cliente. Calidad offset en papel couch√© 150g con acabado brillante. El cliente qued√≥ muy satisfecho con el resultado. üñ®Ô∏èüëå',
                'is_public' => true,
                'created_at' => now()->subHours(6),
                'updated_at' => now()->subHours(6),
            ],
            [
                'company_id' => $createdCompanies[1]->id,
                'user_id' => $createdCompanies[1]->users->first()->id,
                'post_type' => 'equipment',
                'title' => 'Venta M√°quina de Corte',
                'content' => 'üîß Se vende m√°quina de corte POLAR 92EM en excelente estado. Poco uso, ideal para litograf√≠as peque√±as y medianas. Incluye cuchillas adicionales y manual. Precio negociable. Contactar por mensaje privado.',
                'is_public' => true,
                'created_at' => now()->subDays(1),
                'updated_at' => now()->subDays(1),
            ],
            [
                'company_id' => $createdCompanies[2]->id,
                'user_id' => $createdCompanies[2]->users->first()->id,
                'post_type' => 'collaboration',
                'title' => 'Propuesta de Colaboraci√≥n',
                'content' => 'ü§ù Buscamos litograf√≠as aliadas en Cartagena y alrededores para colaboraciones mutuas. Nos especializamos en trabajos de gran formato y podemos complementar servicios con empresas que manejen trabajos comerciales. ¬°Construyamos juntos!',
                'is_public' => true,
                'created_at' => now()->subDays(2),
                'updated_at' => now()->subDays(2),
            ],
            [
                'company_id' => $company->id,
                'user_id' => $user->id,
                'post_type' => 'request',
                'title' => 'Busco Proveedor de Tintas',
                'content' => 'üîç Necesitamos proveedor confiable de tintas para offset. Requerimos entrega quincenal en Cartagena. Preferiblemente con experiencia en el sector gr√°fico. ¬°Esperamos sus propuestas!',
                'is_public' => true,
                'created_at' => now()->subDays(3),
                'updated_at' => now()->subDays(3),
            ]
        ];
        
        $createdPosts = [];
        foreach ($posts as $postData) {
            $post = SocialPost::create($postData);
            $createdPosts[] = $post;
        }
        
        // Create some comments
        $comments = [
            [
                'company_id' => $createdCompanies[0]->id,
                'user_id' => $createdCompanies[0]->users->first()->id,
                'post_id' => $createdPosts[0]->id,
                'content' => '¬°Felicitaciones por esos excelentes resultados! La calidad siempre da frutos. üëè',
                'is_public' => true,
            ],
            [
                'company_id' => $createdCompanies[1]->id,
                'user_id' => $createdCompanies[1]->users->first()->id,
                'post_id' => $createdPosts[0]->id,
                'content' => 'Nos alegra ver el crecimiento de la industria gr√°fica. ¬°Sigamos as√≠!',
                'is_public' => true,
            ],
            [
                'company_id' => $company->id,
                'user_id' => $user->id,
                'post_id' => $createdPosts[1]->id,
                'content' => '¬øTienen disponibilidad para entrega en Cartagena? Me interesa la oferta.',
                'is_public' => true,
            ],
            [
                'company_id' => $createdCompanies[2]->id,
                'user_id' => $createdCompanies[2]->users->first()->id,
                'post_id' => $createdPosts[2]->id,
                'content' => 'Excelente trabajo! Se nota la dedicaci√≥n en cada proyecto.',
                'is_public' => true,
            ]
        ];
        
        foreach ($comments as $commentData) {
            SocialComment::create($commentData);
        }
        
        // Create some likes
        $likes = [
            // Likes on posts
            ['company_id' => $createdCompanies[0]->id, 'user_id' => $createdCompanies[0]->users->first()->id, 'post_id' => $createdPosts[0]->id, 'reaction_type' => 'like'],
            ['company_id' => $createdCompanies[1]->id, 'user_id' => $createdCompanies[1]->users->first()->id, 'post_id' => $createdPosts[0]->id, 'reaction_type' => 'like'],
            ['company_id' => $createdCompanies[2]->id, 'user_id' => $createdCompanies[2]->users->first()->id, 'post_id' => $createdPosts[0]->id, 'reaction_type' => 'love'],
            ['company_id' => $company->id, 'user_id' => $user->id, 'post_id' => $createdPosts[1]->id, 'reaction_type' => 'interested'],
            ['company_id' => $createdCompanies[2]->id, 'user_id' => $createdCompanies[2]->users->first()->id, 'post_id' => $createdPosts[1]->id, 'reaction_type' => 'like'],
            ['company_id' => $createdCompanies[0]->id, 'user_id' => $createdCompanies[0]->users->first()->id, 'post_id' => $createdPosts[2]->id, 'reaction_type' => 'helpful'],
            ['company_id' => $createdCompanies[1]->id, 'user_id' => $createdCompanies[1]->users->first()->id, 'post_id' => $createdPosts[2]->id, 'reaction_type' => 'like'],
        ];
        
        foreach ($likes as $likeData) {
            SocialLike::create($likeData);
        }
        
        // Create some connections
        $connections = [
            [
                'company_id' => $company->id,
                'requester_user_id' => $user->id,
                'target_company_id' => $createdCompanies[0]->id,
                'connection_type' => 'supplier',
                'status' => 'accepted',
                'message' => 'Nos interesa establecer una relaci√≥n comercial para suministro de papel.',
            ],
            [
                'company_id' => $createdCompanies[1]->id,
                'requester_user_id' => $createdCompanies[1]->users->first()->id,
                'target_company_id' => $company->id,
                'connection_type' => 'collaboration',
                'status' => 'pending',
                'message' => 'Propuesta de colaboraci√≥n para proyectos de gran formato.',
            ],
            [
                'company_id' => $company->id,
                'requester_user_id' => $user->id,
                'target_company_id' => $createdCompanies[2]->id,
                'connection_type' => 'referral',
                'status' => 'accepted',
                'message' => 'Intercambio de referencias para clientes especializados.',
            ]
        ];
        
        foreach ($connections as $connectionData) {
            SocialConnection::create($connectionData);
        }
        
        $this->command->info('‚úÖ Social Network demo data created successfully!');
        $this->command->info('üìä Created:');
        $this->command->info('   ‚Ä¢ ' . count($createdCompanies) . ' Additional Companies');
        $this->command->info('   ‚Ä¢ ' . count($createdPosts) . ' Social Posts (various types)');
        $this->command->info('   ‚Ä¢ ' . count($comments) . ' Comments');
        $this->command->info('   ‚Ä¢ ' . count($likes) . ' Likes/Reactions');
        $this->command->info('   ‚Ä¢ ' . count($connections) . ' Business Connections');
        $this->command->info('');
        $this->command->info('üåê Social Network is now active!');
    }
}